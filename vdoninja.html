<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>OR40 Side View</title>

<style>
  :root{
    --plateH: 150px;  /* ネーム帯の高さ */
    --gapH: 20px;     /* ★ゲーム下端→ネーム帯までの距離（20px固定） */
  }

  html, body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#000;
    overflow:hidden;
    font-family:sans-serif;
  }

  #frame{
    position:relative;
    width:100%;
    height:100%;
    background:#000;
  }

  /* ===== ゲーム領域：ネーム帯 + gap 分だけ下を空ける ===== */
  #gameArea{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height: calc(100% - var(--plateH) - var(--gapH));
    background:#000;
    overflow:hidden;
  }

  /* 16:9の箱を gameArea の中で cover させる（サイズはJSで決める） */
  #game16x9{
    position:absolute;
    top:50%;
    left:50%;
    transform: translate(-50%, -50%);
    background:#000;
    overflow:hidden;
  }

  #game{
    width:100%;
    height:100%;
    border:none;
    display:block;
  }

  /* ===== ネーム帯：画面下に固定（gapは上のgameAreaが作ってる） ===== */
  #nameplate{
    position:absolute;
    left:0;
    bottom:0;
    width:100%;
    height: var(--plateH);
    display:flex;
    align-items:flex-end;
    justify-content:center;
    pointer-events:none;
    z-index:10;
  }

  #nameplate img{
    width:auto;
    height:auto;
    display:block;
    transform: scale(0.35);
    transform-origin: bottom center;
  }

  /* ===== 操作パネル：Pキーで表示/非表示・初期非表示 ===== */
  #controls{
    position:fixed;
    right:-9999px;
    top:10px;
    z-index:20;
    background:rgba(0,0,0,0.75);
    padding:8px;
    border-radius:8px;
    display:grid;
    grid-template-columns:repeat(5, 1fr);
    gap:4px;
    min-width:260px;
  }

  #sideLabel{
    grid-column:1 / -1;
    text-align:center;
    font-weight:800;
    font-size:14px;
    padding:6px 0;
    border-radius:6px;
    color:#fff;
    letter-spacing:1px;
    user-select:none;
  }

  #controls button{
    font-size:12px;
    padding:6px 0;
    cursor:pointer;
    white-space:nowrap;
  }
</style>
</head>

<body>
<div id="frame">

  <!-- ゲーム領域 -->
  <div id="gameArea">
    <div id="game16x9">
      <iframe
        id="game"
        allow="autoplay; fullscreen; camera; microphone"
        allowfullscreen
        scrolling="no"></iframe>
    </div>
  </div>

  <!-- ネームプレート -->
  <div id="nameplate">
    <img id="nameImg" src="" alt="">
  </div>

  <!-- 操作パネル -->
  <div id="controls">
    <div id="sideLabel">LEFT</div>
  </div>

</div>

<script>
  const MAX_PLAYERS = 40;

  function pad(n){ return String(n).padStart(3,"0"); }

  function viewUrl(n){
    return `https://vdo.ninja/?view=OR40_C${pad(n)}&cleanoutput`;
  }

  function plateUrl(n){
    return `overlays/P${pad(n)}.png`;
  }

  // side 判定（ラベル色）
  const side = (new URLSearchParams(location.search).get("side") || "left").toLowerCase();
  const sideLabel = document.getElementById("sideLabel");
  if(side === "right"){
    sideLabel.textContent = "RIGHT";
    sideLabel.style.background = "rgba(198,40,40,0.95)";
  }else{
    sideLabel.textContent = "LEFT";
    sideLabel.style.background = "rgba(21,101,192,0.95)";
  }

  // ===== 16:9を「gameArea基準」で cover させる（黒帯を潰す） =====
  function fitGame16x9Cover(){
    const area = document.getElementById("gameArea");
    const box  = document.getElementById("game16x9");

    const W = area.clientWidth;
    const H = area.clientHeight;

    const target = 16/9;
    const ar = W / H;

    let bw, bh;
    if(ar >= target){
      // 横が広い：高さ基準で合わせて左右を切る
      bh = H;
      bw = Math.ceil(H * target);
    }else{
      // 縦が長い：幅基準で合わせて上下を切る
      bw = W;
      bh = Math.ceil(W / target);
    }

    box.style.width  = bw + "px";
    box.style.height = bh + "px";
  }

  window.addEventListener("resize", fitGame16x9Cover);

  function setPlayer(n){
    document.getElementById("game").src = viewUrl(n);
    const img = document.getElementById("nameImg");
    img.src = plateUrl(n);
    img.alt = `P${pad(n)}`;
  }

  // ボタン生成
  const controls = document.getElementById("controls");
  for(let i=1;i<=MAX_PLAYERS;i++){
    const b = document.createElement("button");
    b.textContent = `P${pad(i)}`;
    b.onclick = ()=>setPlayer(i);
    controls.appendChild(b);
  }

  // Pキーで表示/非表示（初期は非表示）
  let controlsVisible = false;
  function setControlsVisible(v){
    controlsVisible = v;
    controls.style.right = controlsVisible ? "10px" : "-9999px";
  }
  setControlsVisible(false);

  document.addEventListener("keydown",(e)=>{
    if(e.key.toLowerCase()==="p") setControlsVisible(!controlsVisible);
  });

  // 初期化
  fitGame16x9Cover();
  setPlayer(1);
</script>
</body>
</html>
