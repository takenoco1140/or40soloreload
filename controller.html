<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>OR40 Controller</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{ margin:12px; font-family:system-ui,sans-serif; background:#111; color:#eee; }
  h2{ margin:0 0 10px; font-size:18px; }
  .panel{ background:#181818; border:1px solid #2a2a2a; border-radius:12px; padding:12px; margin-bottom:12px; }
  .row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  input{ background:#0f0f0f; color:#eee; border:1px solid #333; border-radius:10px; padding:10px; font-size:16px; width:120px; }
  button{ background:#2a2a2a; color:#eee; border:1px solid #3a3a3a; border-radius:10px; padding:10px 12px; cursor:pointer; }
  button:hover{ background:#333; }
  .grid{ display:grid; grid-template-columns:repeat(5,1fr); gap:8px; }
  .status{ font-size:13px; opacity:.85; }
  code{ display:block; background:#0f0f0f; border:1px solid #333; border-radius:8px; padding:8px; color:#9fd; overflow:auto; }
  label{ display:flex; gap:8px; align-items:center; font-size:14px; opacity:.9; }
  input[type="checkbox"]{ width:auto; }
</style>
</head>

<body>
<h2>OR40 Controller（localStorage）</h2>

<div class="panel">
  <div class="row">
    <input id="num" type="number" min="1" max="40" value="1">
    <button id="go">保存</button>
    <button id="prev">◀</button>
    <button id="next">▶</button>
    <span class="status" id="status"></span>
  </div>

  <div class="row" style="margin-top:10px;">
    <label><input id="np" type="checkbox" checked> ネームプレート表示</label>
    <span class="status">※反映は OBSで Blank→Game</span>
  </div>

  <p class="status" style="margin:10px 0 6px;">OBSブラウザソースURL（固定）</p>
  <code id="obsUrl"></code>
</div>

<div class="panel">
  <div class="grid" id="grid"></div>
</div>

<script>
  const MAX = 40;

  // ★ or40_single.html と一致させる
  const LS_KEY_PLAYER = "or40_player";
  const LS_KEY_NP     = "or40_np";

  // ★ OBSに入れるURL（固定）
  const OBS_URL = "https://takenoco1140.github.io/or40soloreload/or40_single.html";

  const num = document.getElementById("num");
  const status = document.getElementById("status");
  const grid = document.getElementById("grid");
  const obsUrl = document.getElementById("obsUrl");
  const np = document.getElementById("np");

  const pad3 = n => String(n).padStart(3,"0");

  function clamp(v){
    let n = Number(v);
    if(!Number.isFinite(n)) n = 1;
    return Math.min(MAX, Math.max(1, n));
  }

  function save(){
    const n = clamp(num.value);
    num.value = n;

    localStorage.setItem(LS_KEY_PLAYER, String(n));
    localStorage.setItem(LS_KEY_NP, np.checked ? "1" : "0");

    status.textContent = `保存: P${pad3(n)} / NP:${np.checked ? "ON" : "OFF"}`;
  }

  function prev(){ num.value = clamp(Number(num.value) - 1); save(); }
  function next(){ num.value = clamp(Number(num.value) + 1); save(); }

  function initFromLocalStorage(){
    const raw = localStorage.getItem(LS_KEY_PLAYER);
    const n = clamp(raw ?? 1);
    num.value = n;

    const rawNp = localStorage.getItem(LS_KEY_NP);
    np.checked = (rawNp === null) ? true : (rawNp !== "0");

    status.textContent = `現在: P${pad3(n)} / NP:${np.checked ? "ON" : "OFF"}`;
  }

  // キー操作
  document.addEventListener("keydown", e=>{
    if(e.key === "Enter") save();
    if(e.key === "ArrowLeft") prev();
    if(e.key === "ArrowRight") next();
  });

  document.getElementById("go").addEventListener("click", save);
  document.getElementById("prev").addEventListener("click", prev);
  document.getElementById("next").addEventListener("click", next);
  np.addEventListener("change", save);

  // ボタン生成
  for(let i=1;i<=MAX;i++){
    const b = document.createElement("button");
    b.textContent = i;
    b.onclick = ()=>{ num.value = i; save(); };
    grid.appendChild(b);
  }

  obsUrl.textContent = OBS_URL;

  initFromLocalStorage();
</script>
</body>
</html>
