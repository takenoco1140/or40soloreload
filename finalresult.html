<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Final Results Overlay</title>
<style>
html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden}
body{display:flex;justify-content:center;align-items:center;font-family:"Segoe UI","Noto Sans JP",system-ui,sans-serif}
.board{position:relative;width:1920px;height:1080px;background:url("./result/総合結果台紙.jpg") center/contain no-repeat;background-color:#000;color:#fff}
.text{position:absolute;text-align:center;text-shadow:0 2px 6px rgba(0,0,0,.8)}
.hidden{display:none!important}
.rank{width:520px}
.rank .place{font-size:40px;font-weight:800;margin-bottom:6px}
.rank .nameimg{display:block;margin:0 auto;height:96px;width:auto;max-width:520px;object-fit:contain;filter:drop-shadow(0 3px 10px rgba(0,0,0,.75));opacity:0}
.rank .scoreline{margin-top:10px;font-size:30px;font-weight:700;white-space:nowrap}
.first{top:580px;left:50%;transform:translateX(-50%)}
.second{top:650px;left:320px}
.third{top:650px;right:320px}
.first .place{color:#ffd966}.second .place{color:#9fe8d5}.third .place{color:#ffb07c}
.mvp{position:absolute;top:380px;left:50%;transform:translateX(-50%);text-align:center}
.mvp img{height:90px;opacity:0}
.mvp .kills{margin-top:6px;font-size:28px;font-weight:800}
#openPanel{position:absolute;top:16px;right:16px;z-index:10}
</style>
</head>
<body>
<div class="board">
<button id="openPanel">操作</button>
<div id="rank1" class="text rank first"><div class="place">1st</div><img id="img1" class="nameimg"><div id="score1" class="scoreline"></div></div>
<div id="rank2" class="text rank second"><div class="place">2nd</div><img id="img2" class="nameimg"><div id="score2" class="scoreline"></div></div>
<div id="rank3" class="text rank third"><div class="place">3rd</div><img id="img3" class="nameimg"><div id="score3" class="scoreline"></div></div>
<div id="mvp" class="mvp hidden"><img id="mvpImg"><div id="mvpKills" class="kills"></div></div>
</div>
<script>
const BASE_PATH = './name';
const rankEls={1:rank1,2:rank2,3:rank3};
const imgEls={1:img1,2:img2,3:img3};
const scoreEls={1:score1,2:score2,3:score3};
let toggleMode='both';
function pad(n){return String(n).padStart(3,'0')}
function setName(r,n){imgEls[r].src=`${BASE_PATH}/N${pad(n)}.png`;imgEls[r].style.opacity=1}
function setScore(r,rank,kill){scoreEls[r].innerHTML=`総合 ${rank+kill}pt（順位 ${rank}pt、撃破 ${kill}pt）`}
function toggleRank(r){
 if(toggleMode==='both'){
  rankEls[r].classList.toggle('hidden');
 }else{
  imgEls[r].classList.toggle('hidden');
  scoreEls[r].classList.toggle('hidden');
 }
}
function toggleModeSet(m){toggleMode=m}
function setMVP(n,k){mvp.classList.remove('hidden');mvpImg.src=`${BASE_PATH}/N${pad(n)}.png`;mvpImg.style.opacity=1;mvpKills.textContent=`最多撃破 ${k}`}
let win;
document.getElementById('openPanel').onclick=()=>{
 if(win&&!win.closed){win.focus();return}
 win=window.open('','panel','width=900,height=720');
 win.document.write(`<!DOCTYPE html><html><head><meta charset=\"utf-8\"><title>操作パネル</title></head>
 <body style=\"background:#111;color:#fff;font-family:sans-serif;padding:16px\">
 <h2>表示切替モード</h2>
 <button onclick=\"opener.toggleModeSet('both')\">名前＋ポイント同時</button>
 <button onclick=\"opener.toggleModeSet('separate')\">名前／ポイント別</button>
 <h2>表示切替</h2>
 <button onclick=\"opener.toggleRank(1)\">1位</button>
 <button onclick=\"opener.toggleRank(2)\">2位</button>
 <button onclick=\"opener.toggleRank(3)\">3位</button>
 <h2>名前割当（N001〜N040）</h2>
 <div id=\"grid\"></div>
 <h2>ポイント</h2>
 1位 順位<input id=r1 size=4> 撃破<input id=k1 size=4>
 <button onclick=\"opener.setScore(1,Number(r1.value||0),Number(k1.value||0))\">反映</button><br><br>
 2位 順位<input id=r2 size=4> 撃破<input id=k2 size=4>
 <button onclick=\"opener.setScore(2,Number(r2.value||0),Number(k2.value||0))\">反映</button><br><br>
 3位 順位<input id=r3 size=4> 撃破<input id=k3 size=4>
 <button onclick=\"opener.setScore(3,Number(r3.value||0),Number(k3.value||0))\">反映</button>
 <h2>MVP</h2>
 番号<input id=n size=4> 撃破数<input id=mk size=4>
 <button onclick=\"opener.setMVP(n.value,mk.value)\">反映</button>
 <script>
 for(let i=1;i<=40;i++){const b=document.createElement('button');b.textContent='N'+String(i).padStart(3,'0');b.onclick=()=>opener.setName(1,i);grid.appendChild(b)}
 <\/script>
 </body></html>`);
}
</script>
</body>
</html>
