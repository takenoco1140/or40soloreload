<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Final Results Overlay</title>
<style>
  html,body{
    margin:0;padding:0;width:100%;height:100%;
    background:#000;
    /* これが原因で fixed が見切れる環境があるので、ここは hidden をやめる */
    overflow:visible;
  }
  body{
    display:flex;
    justify-content:center;
    align-items:center;
    font-family:"Segoe UI","Noto Sans JP",system-ui,sans-serif;
    user-select:none;
  }

  /* === 台紙 === */
  .board{
    position:relative;
    width:1920px;height:1080px;
    background:url("./result/総合結果台紙.jpg") center/contain no-repeat;
    background-color:#000;
    color:#fff;
    z-index:1;
  }

  .text{position:absolute;text-align:center;text-shadow:0 2px 6px rgba(0,0,0,.8)}
  .hidden{display:none!important}

  .rank{width:520px}
  .rank .place{font-size:40px;font-weight:800;margin-bottom:6px}
  .rank .nameimg{
    display:block;margin:0 auto;
    height:96px;width:auto;max-width:520px;
    object-fit:contain;
    filter:drop-shadow(0 3px 10px rgba(0,0,0,.75));
    opacity:0;
  }
  .rank .scoreline{margin-top:10px;font-size:30px;font-weight:700;white-space:nowrap}

  .first{top:580px;left:50%;transform:translateX(-50%)}
  .second{top:650px;left:320px}
  .third{top:650px;right:320px}
  .first .place{color:#ffd966}.second .place{color:#9fe8d5}.third .place{color:#ffb07c}

  /* MVP */
  .mvp{position:absolute;top:380px;left:50%;transform:translateX(-50%);text-align:center}
  .mvp .row{display:flex;align-items:center;justify-content:center;gap:14px}
  .mvp img{height:90px;object-fit:contain;filter:drop-shadow(0 3px 10px rgba(0,0,0,.75));opacity:0}
  .mvp .kills{margin-top:6px;font-size:28px;font-weight:800}

  /* =========================
     操作パネル（右側固定）
     重要：z-index を付けて「必ず最前面」にする
     ========================= */
  .controls{
    position:fixed;
    top:0;right:0;
    width:360px;height:100vh;
    background:rgba(0,0,0,.72);
    border-left:1px solid rgba(255,255,255,.15);
    padding:14px;
    box-sizing:border-box;
    color:#fff;
    z-index:9999;                 /* ←これがないと見えない/押せない環境がある */
    pointer-events:auto;
    overflow:auto;
  }

  .panel{
    background:rgba(255,255,255,.06);
    border:1px solid rgba(255,255,255,.12);
    border-radius:12px;
    padding:12px;
    margin-bottom:12px
  }
  .panel h3{margin:0 0 8px;font-size:13px;font-weight:900}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .btn{
    appearance:none;border:0;border-radius:10px;
    padding:8px 10px;font-size:12px;font-weight:900;
    cursor:pointer;background:rgba(255,255,255,.12);color:#fff
  }
  .btn:hover{background:rgba(255,255,255,.18)}
  .btn.primary{background:rgba(255,255,255,.22)}
  .btn.danger{background:rgba(255,90,90,.3)}
  .grid40{display:grid;grid-template-columns:repeat(10,1fr);gap:6px}
  input{
    width:100%;
    padding:6px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.2);
    background:#000;
    color:#fff;
    font-weight:800;
    box-sizing:border-box;
  }
  hr{border:0;border-top:1px solid rgba(255,255,255,.12);margin:10px 0}
</style>
</head>
<body>

<div class="board">
  <div id="rank1" class="text rank first">
    <div class="place">1st</div>
    <img id="img1" class="nameimg" alt="1st name">
    <div id="score1" class="scoreline"></div>
  </div>

  <div id="rank2" class="text rank second">
    <div class="place">2nd</div>
    <img id="img2" class="nameimg" alt="2nd name">
    <div id="score2" class="scoreline"></div>
  </div>

  <div id="rank3" class="text rank third">
    <div class="place">3rd</div>
    <img id="img3" class="nameimg" alt="3rd name">
    <div id="score3" class="scoreline"></div>
  </div>

  <div id="mvp" class="mvp hidden">
    <div class="row">
      <img src="./result/mostelim.png" style="opacity:1" alt="most elim icon">
      <img id="mvpImg" alt="mvp name">
    </div>
    <div id="mvpKills" class="kills"></div>
  </div>
</div>

<!-- 操作パネル -->
<div class="controls" id="controls">
  <div class="panel">
    <h3>表示切替</h3>
    <div class="row">
      <button class="btn primary" onclick="allOff()">全OFF</button>
      <button class="btn" onclick="togglePt()">pt</button>
      <button class="btn" onclick="toggleName()">名前</button>
      <button class="btn" onclick="toggleBoth()">同時</button>
    </div>
  </div>

  <div class="panel">
    <h3>名前画像（押した順に1→2→3）</h3>
    <div class="grid40" id="grid40"></div>
  </div>

  <div class="panel">
    <h3>ポイント</h3>

    <label>1位 順位</label><input id="p1r" type="number" value="0">
    <label>1位 撃破</label><input id="p1k" type="number" value="0">
    <button class="btn primary" onclick="applyPoints(1)">1位反映</button>

    <hr>

    <label>2位 順位</label><input id="p2r" type="number" value="0">
    <label>2位 撃破</label><input id="p2k" type="number" value="0">
    <button class="btn primary" onclick="applyPoints(2)">2位反映</button>

    <hr>

    <label>3位 順位</label><input id="p3r" type="number" value="0">
    <label>3位 撃破</label><input id="p3k" type="number" value="0">
    <button class="btn primary" onclick="applyPoints(3)">3位反映</button>
  </div>

  <div class="panel">
    <h3>MVP（最多撃破賞）</h3>
    <div class="row">
      <button class="btn primary" onclick="mvpOn()">ON</button>
      <button class="btn danger" onclick="mvpOff()">OFF</button>
    </div>
    <label style="display:block;margin-top:8px;">撃破数</label>
    <input id="mvpKillInput" type="number" value="0">
    <button class="btn primary" style="margin-top:8px;" onclick="applyMvp()">反映</button>
  </div>
</div>

<script>
  const BASE='./name';
  const imgEls={1:img1,2:img2,3:img3};
  const scoreEls={1:score1,2:score2,3:score3};
  let assignIndex=0;

  function pad(n){return String(n).padStart(3,'0')}

  function setName(r,n){
    imgEls[r].src = encodeURI(`${BASE}/N${pad(n)}.png`);
    imgEls[r].style.opacity = 1;
  }

  function applyPoints(r){
    const rp=+document.getElementById(`p${r}r`).value||0;
    const kp=+document.getElementById(`p${r}k`).value||0;
    scoreEls[r].innerHTML=`総合 ${rp+kp}pt（順位 ${rp}pt、撃破 ${kp}pt）`;
  }

  function allOff(){
    [1,2,3].forEach(r=>{
      imgEls[r].classList.add('hidden');
      scoreEls[r].classList.add('hidden');
    });
  }
  function togglePt(){ [1,2,3].forEach(r=>scoreEls[r].classList.remove('hidden')) }
  function toggleName(){ [1,2,3].forEach(r=>imgEls[r].classList.remove('hidden')) }
  function toggleBoth(){ [1,2,3].forEach(r=>{imgEls[r].classList.remove('hidden');scoreEls[r].classList.remove('hidden')}) }

  function mvpOn(){ mvp.classList.remove('hidden') }
  function mvpOff(){ mvp.classList.add('hidden') }
  function applyMvp(){ mvpKills.textContent=`最多撃破 ${document.getElementById('mvpKillInput').value||0}` }

  const grid=document.getElementById('grid40');
  for(let i=1;i<=40;i++){
    const b=document.createElement('button');
    b.className='btn';
    b.textContent=`N${pad(i)}`;
    b.onclick=()=>{
      const r=[1,2,3][Math.min(assignIndex,2)];
      setName(r,i);
      imgEls[r].classList.remove('hidden');
      assignIndex=Math.min(assignIndex+1,2);
    };
    grid.appendChild(b);
  }

  // 初期：全OFF
  allOff();
</script>
</body>
</html>
