<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OR40 Single View</title>

<style>
:root{
  --panelSize: 340px;

  --plateTop: 2%;
  --plateLeft: 2%;
  --plateWidth: 22%;
}

html, body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  overflow:hidden;
  font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
}

/* ===== 全体：左＝映像 / 右＝操作 ===== */
#app{
  width:100%;
  height:100%;
  display:grid;
  grid-template-columns: 1fr var(--panelSize);
}

/* ===== 映像側 ===== */
#stage{
  position:relative;
  background:#000;
  overflow:hidden;
}

#gameArea{
  position:absolute;
  inset:0;
}

#game16x9{
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  background:#000;
}

#game{
  width:100%;
  height:100%;
  border:none;
  display:block;
}

/* ネームプレート */
#nameplate{
  position:absolute;
  top:var(--plateTop);
  left:var(--plateLeft);
  pointer-events:none;
}
#nameplate img{
  width:var(--plateWidth);
  height:auto;
}

/* ===== 操作パネル ===== */
#panel{
  background:#0b0b0b;
  border-left:1px solid #222;
  color:#eee;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

#panelHeader{
  padding:10px;
  border-bottom:1px solid #222;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

#now{
  font-weight:700;
  font-size:14px;
}

button{
  border:1px solid #2a2a2a;
  background:#141414;
  color:#eee;
  border-radius:10px;
  padding:8px 10px;
  cursor:pointer;
}
button:hover{ background:#1b1b1b; }

input{
  background:#0f0f0f;
  color:#eee;
  border:1px solid #2a2a2a;
  border-radius:10px;
  padding:8px;
}

#tools{
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
  border-bottom:1px solid #222;
}

.row{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}

#gridWrap{
  padding:10px;
  overflow:auto;
  height:100%;
}

/* ★4列ボタン */
#grid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:8px;
}

.pbtn{
  padding:10px 0;
  border-radius:12px;
}
.pbtn.active{
  outline:2px solid rgba(255,255,255,.35);
  background:#202020;
}
.pbtn:disabled{
  background:#0f0f0f;
  color:#666;
  border-color:#222;
  cursor:not-allowed;
}
.pbtn.hidden{
  visibility:hidden;
  pointer-events:none;
}
</style>
</head>

<body>
<div id="app">

  <!-- ===== 映像 ===== -->
  <div id="stage">
    <div id="gameArea">
      <div id="game16x9">
        <iframe id="game"
          allow="autoplay; fullscreen; camera; microphone"
          allowfullscreen></iframe>

        <div id="nameplate">
          <img id="nameImg" src="" alt="">
        </div>
      </div>
    </div>
  </div>

  <!-- ===== 操作 ===== -->
  <aside id="panel">
    <div id="panelHeader">
      <div id="now">P001</div>
      <div>
        <button id="prevBtn">◀</button>
        <button id="nextBtn">▶</button>
      </div>
    </div>

    <div id="tools">
      <div class="row">
        <input id="num" type="number" min="1" max="40" />
        <button id="goBtn">GO</button>
        <button id="npBtn">NP</button>
      </div>
      <div class="row" style="font-size:12px;opacity:.7;">
        有効番号：1～25 と 40
      </div>
    </div>

    <div id="gridWrap">
      <div id="grid"></div>
    </div>
  </aside>

</div>

<script>
const MAX = 40;

/* ★使う番号 */
const ACTIVE_PLAYERS = [
  ...Array.from({length:25},(_,i)=>i+1),
  40
];
const UNUSED_MODE = "disable"; // or "hide"

const ACTIVE_SET = new Set(ACTIVE_PLAYERS);
const isActive = n => ACTIVE_SET.has(n);

const pad = n => String(n).padStart(3,"0");
const viewUrl = n => `https://vdo.ninja/?view=OR40_C${pad(n)}&cleanoutput`;
const plateUrl = n => `overlays/P${pad(n)}.png`;

let current = ACTIVE_PLAYERS[0];
let nameplateOn = true;

/* 16:9 fit */
function fit(){
  const a = gameArea;
  const b = game16x9;
  const W = a.clientWidth, H = a.clientHeight;
  const r = W/H, t = 16/9;
  if(r>=t){ b.style.height=H+"px"; b.style.width=(H*t)+"px"; }
  else{ b.style.width=W+"px"; b.style.height=(W/t)+"px"; }
}
window.addEventListener("resize", fit);

function setPlayer(n){
  if(!isActive(n)) return;
  current = n;
  const t = Date.now();
  game.src = "about:blank";
  setTimeout(()=>game.src = viewUrl(n)+`&t=${t}`,30);
  nameImg.src = plateUrl(n)+`?t=${t}`;
  now.textContent = `P${pad(n)}`;
  num.value = n;
  updateButtons();
}

function updateButtons(){
  document.querySelectorAll(".pbtn").forEach(b=>{
    const n = Number(b.dataset.n);
    b.classList.toggle("active", n===current);
  });
}

function buildGrid(){
  grid.innerHTML="";
  for(let i=1;i<=MAX;i++){
    const b = document.createElement("button");
    b.className="pbtn";
    b.textContent=i;
    b.dataset.n=i;

    if(!isActive(i)){
      b.disabled=true;
      if(UNUSED_MODE==="hide") b.classList.add("hidden");
    }

    b.onclick=()=>setPlayer(i);
    grid.appendChild(b);
  }
}

function nextActive(dir){
  let n=current;
  for(let i=0;i<MAX;i++){
    n+=dir;
    if(n<1) n=MAX;
    if(n>MAX) n=1;
    if(isActive(n)) return n;
  }
  return current;
}

/* controls */
goBtn.onclick=()=>setPlayer(Number(num.value));
prevBtn.onclick=()=>setPlayer(nextActive(-1));
nextBtn.onclick=()=>setPlayer(nextActive(1));
npBtn.onclick=()=>{
  nameplateOn=!nameplateOn;
  nameplate.style.display=nameplateOn?"block":"none";
};

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") setPlayer(nextActive(-1));
  if(e.key==="ArrowRight") setPlayer(nextActive(1));
  if(e.key==="Enter") setPlayer(Number(num.value));
});

/* init */
buildGrid();
fit();
setPlayer(current);
</script>
</body>
</html>
