<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>OR40 Controller</title>

<style>
  html, body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    background:#111;
    font-family:sans-serif;
    overflow:hidden; /* スクロール禁止 */
  }

  #container{
    box-sizing:border-box;
    width:100%;
    height:100%;
    padding:10px;
  }

  /* 3列 × 14行（40人なので最後の行が余る） */
  #grid{
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(14, 1fr);
    gap:6px;
    width:100%;
    height:100%;
  }

  .btn{
    position:relative;
    background:#000;
    border:1px solid #333;
    border-radius:6px;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }

  .btn:hover{
    border-color:#666;
  }

  .btn img{
    max-width:100%;
    max-height:100%;
    object-fit:contain;
    pointer-events:none;
  }

  .btn.active{
    outline:2px solid #4af;
    outline-offset:-2px;
  }
</style>
</head>

<body>
<div id="container">
  <div id="grid"></div>
</div>

<script>
  const MAX_PLAYERS = 40;
  const grid = document.getElementById("grid");

  function pad(n){
    return String(n).padStart(3,"0");
  }

  function plateUrl(n){
    return `overlays/P${pad(n)}.png`;
  }

  function selectPlayer(n, btn){
    if(!window.opener || typeof window.opener.setPlayer !== "function"){
      return;
    }
    window.opener.setPlayer(n);

    document.querySelectorAll(".btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
  }

  for(let i=1;i<=MAX_PLAYERS;i++){
    const btn = document.createElement("div");
    btn.className = "btn";

    const img = document.createElement("img");
    img.src = plateUrl(i);
    img.alt = `P${pad(i)}`;

    btn.appendChild(img);
    btn.addEventListener("click", ()=>selectPlayer(i, btn));

    grid.appendChild(btn);
  }
</script>
</body>
</html>
